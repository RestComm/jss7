<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "SS7_Stack_User_Guide.ent">
%BOOK_ENTITIES;
]>
<section id="shell_m3ua">
	<title>M3UA Management</title>
	<para>
		M3UA stack is also responsible to manage the SCTP Associations. 
	</para>
		
	<section id="shell_m3ua_sctp">
		<title>M3UA Management - SCTP</title>
		<para>
			M3UA - SCTP is managed by <literal>sctp</literal> command. It allows to perform following:
		</para>
		<itemizedlist>
			<listitem>
				<para><command>sctp server create</command></para>
			</listitem>
			<listitem>
				<para><command>sctp server destroy</command></para>
			</listitem>
			<listitem>
				<para><command>sctp server start</command></para>
			</listitem>
			<listitem>
				<para><command>sctp server stop</command></para>
			</listitem>		
			<listitem>
				<para><command>sctp server show</command></para>
			</listitem>			
			<listitem>
				<para><command>sctp association create</command></para>
			</listitem>		
			<listitem>
				<para><command>sctp association destroy</command></para>
			</listitem>		
			<listitem>
				<para><command>sctp association show</command></para>
			</listitem>							
		</itemizedlist>		
			
			
		<section
			id="shell_m3ua_sctp_server_create">
			<title>Create SCTP Server</title>
			<para>SCTP Server can be created by issuing command with following structure:</para>
			<programlisting>sctp server create &lt;server-name&gt; &lt;host-ip&gt; &lt;host-port&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>server-name</term>
					<listitem>
						<para>
							Unique name assigned to the server.
						</para>
					</listitem>
				</varlistentry>
				
				<varlistentry>
					<term>host-ip</term>
					<listitem>
						<para>
							The host ip address where underlying SCTP server socket will bind 
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>host-port</term>
					<listitem>
						<para>
							The host port where underlying SCTP server socket will bind 
						</para>
					</listitem>
				</varlistentry>					
			</variablelist>
			<example>
				<title>SCTP Server creation</title>
				<screen>
mobicents(127.0.0.1:3436)>sctp server create TestServer 127.0.0.1 2905
Successfully added Server=TestServer
				</screen>
			</example>
		</section>	
		
		<section
			id="shell_m3ua_sctp_server_destroy">
			<title>Destroy SCTP Server</title>
			<para>SCTP Server can be destroyed by issuing command with following structure:</para>
			<programlisting>sctp server destroy &lt;server-name&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>server-name</term>
					<listitem>
						<para>
							Unique name of the server to be destroyed. Make sure server is stopped before destroying.
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Destroy SCTP Server</title>
				<screen>
mobicents(127.0.0.1:3436)>sctp server destroy TestServer
Successfully removed Server=TestServer
				</screen>
			</example>
		</section>	
		
		<section
			id="shell_m3ua_sctp_server_start">
			<title>Start SCTP Server</title>
			<para>SCTP Server can be started by issuing command with following structure:</para>
			<programlisting>sctp server start &lt;server-name&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>server-name</term>
					<listitem>
						<para>
							Unique name of the server to be started. The underlying SCTP server socket is bound to ip:port configured at creation time. 
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Start SCTP Server</title>
				<screen>
mobicents(127.0.0.1:3436)>sctp server start TestServer
Successfully started Server=TestServer
				</screen>
			</example>
		</section>				
		
		<section
			id="shell_m3ua_sctp_server_stop">
			<title>Stop SCTP Server</title>
			<para>SCTP Server can be stopped by issuing command with following structure:</para>
			<programlisting>sctp server stop &lt;server-name&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>server-name</term>
					<listitem>
						<para>
							Unique name of the server to be stopped. The underlying socket is closed at this point and all resource are released. 
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Stop SCTP Server</title>
				<screen>
mobicents(127.0.0.1:3436)>sctp server stop TestServer
Successfully stopped Server=TestServer
				</screen>
			</example>
		</section>	
		
		<section
			id="shell_m3ua_sctp_server_show">
			<title>Show SCTP Server</title>
			<para>SCTP Server's configuration can be viewed by issuing command with following structure:</para>
			<programlisting>sctp server show</programlisting>
			<example>
				<title>Show SCTP Server</title>
				<screen>
mobicents(127.0.0.1:3436)>sctp server show
Not supported yet
				</screen>
			</example>
		</section>			

		<section
			id="shell_m3ua_sctp_association_create">
			<title>Create SCTP Association</title>
			<para>Association can be created by issuing command with following structure:</para>
			<programlisting>sctp association create &lt;assoc-name&gt; &lt;CLIENT | SERVER&gt; &lt;server-name&gt; &lt;peer-ip&gt; &lt;peer-port&gt; &lt;host-ip&gt; &lt;host-port&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>assoc-name</term>
					<listitem>
						<para>
							Unique name of the association 
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>CLIENT | SERVER</term>
					<listitem>
						<para>
							If this association is client side or server side. If its client side, it will initiate the connection to peer and bind's to host-ip:host-port trying to connect to peer-ip:peer-port.
						</para>
						<para>If its server side, it waits for peer to initiate connection. The connection request will be accepted from peer-ip:peer-port. host-ip and host-port is not required, even if passed 
						it will be ignored</para>
					</listitem>
				</varlistentry>	
				<varlistentry>
					<term>server-name</term>
					<listitem>
						<para>
							If this association is server side, server-name must be passed to associate with server. Server with server-name should have already been created by 
							using command <xref linkend="shell_m3ua_sctp_server_create"/>
						</para>
						<para>If this association is client side, server-name shouldn't be passed.
						</para>
					</listitem>
				</varlistentry>								
			</variablelist>
			<example>
				<title>Create CLIENT SCTP Association</title>
				<screen>
mobicents(192.168.56.1:3436)>sctp association create Assoc1 CLIENT 192.168.56.101 2905 192.168.56.1 2905
Successfully added client Association=Assoc1
				</screen>
			</example>
			<example>
				<title>Create SERVER SCTP Association</title>
				<screen>
mobicents(192.168.56.1:3436)>sctp association create Assoc2 SERVER TestServer 192.168.56.1 2905
Successfully added server Association=TestServer
				</screen>
			</example>			
		</section>	

		<section
			id="shell_m3ua_sctp_association_destroy">
			<title>Destroy SCTP Association</title>
			<para>Association can be destroyed by issuing command with following structure:</para>
			<programlisting>sctp association destroy &lt;assoc-name&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>assoc-name</term>
					<listitem>
						<para>
							Unique name of the association to be destroyed
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Destroy SCTP Association</title>
				<screen>
mobicents(192.168.56.1:3436)>sctp association destroy Assoc1
Successfully removed association=Assoc1
				</screen>
			</example>
		</section>
		
		<section
			id="shell_m3ua_sctp_association_show">
			<title>Show SCTP Association</title>
			<para>Configuration of Association can be viewed by issuing command with following structure:</para>
			<programlisting>sctp association show</programlisting>
			
			<example>
				<title>Show SCTP Association</title>
				<screen>
mobicents(192.168.56.1:3436)>sctp association show
Not supported yet
				</screen>
			</example>
		</section>		
	</section>
	
	
	
	<section id="shell_m3ua_as_side">
		<title>M3UA Management</title>
		<para>
			M3UA is managed by <literal>m3ua</literal> command. It allows to perform following:
		</para>
		<itemizedlist>
			<listitem>
				<para><command>m3ua as create</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua as destroy</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua as show</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua asp create</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua asp destroy</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua asp show</command></para>
			</listitem>			
			<listitem>
				<para><command>m3ua asp start</command></para>
			</listitem>			
			<listitem>
				<para><command>m3ua asp stop</command></para>
			</listitem>		
			<listitem>
				<para><command>m3ua as add</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua as remove</command></para>
			</listitem>	
			<listitem>
				<para><command>m3ua route add</command></para>
			</listitem>		
			<listitem>
				<para><command>m3ua route remove</command></para>
			</listitem>
			<listitem>
				<para><command>m3ua route show</command></para>
			</listitem>										
		</itemizedlist>		
			
			
		<section
			id="shell_m3ua_as_side_create">
			<title>Create AS</title>
			<para>Application Server (AS) can be created by issuing command with following structure:</para>
			<programlisting>m3ua as create &lt;as-name&gt; &lt;AS | SGW | IPSP&gt; mode &lt;SE | DE&gt; ipspType &lt;client | server&gt; rc &lt;routing-context&gt; traffic-mode &lt;traffic mode&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as-name</term>
					<listitem>
						<para>simple string name, which identifies AS. Make sure this is unique. This is mandatory parameter</para>
					</listitem>
				</varlistentry>	
				<varlistentry>
					<term>AS | SGW | IPSP</term>
					<listitem>
						<para>Specify if this is of type AS or SGW or IPSP. This is mandatory parameter</para>
					</listitem>
				</varlistentry>	
				<varlistentry>
					<term>SE | DE</term>
					<listitem>
						<para>Specify if the single or double exchange of ASP State Maintenance (ASPSM) and ASP Traffic Maintenance (ASPTM) messages should be performed.
						This is mandatory parameter.</para>
					</listitem>
				</varlistentry>		
				<varlistentry>
					<term>client | server</term>
					<listitem>
						<para>If As if of type IPSP, speicfy here if its client or server type. </para>
					</listitem>
				</varlistentry>													
				<varlistentry>
					<term>routing-context</term>
					<listitem>
						<para>
							refers to Routing Context already configured on M3UA stack on SGW side. This is optional parameter. 
							If no Routing Context is passed, Application Server Process (assigned to this AS) may not be configured 
							to process signalling traffic related to more than one Application Server, over a single SCTP Association
						</para>
						<para>
							Also if ASP is configured to process siganlling traffic from always one AS, irrespective of received messages
							have routing context set or not, it will always be delieverd to AS for further processing. However if ASP 
							is configured to process siganlling traffic related to more than one AS over a single SCTP Association and 
							signalling message is received without RC, it drops the message and sends back Error message. Respective 
							log4j error is also logged.
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>traffic-mode</term>
					<listitem>
						<para>
							Traffic mode for ASP's. By default its loadshare. Mobicents M3UA only supports loadshare and override, broadcast is not supported.
						</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>AS (IPSP) creation</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as create AS1 IPSP mode DE ipspType server rc 1 traffic-mode loadshare
Successfully created AS name=AS1
				</screen>
			</example>
			<example>
				<title>AS creation</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as create AS2 AS mode SE rc 100 traffic-mode loadshare
Successfully created AS name=AS2
				</screen>
			</example>			
		</section>	
		
		<section
			id="shell_m3ua_as_side_destroy">
			<title>Destroy AS</title>
			<para>Application Server (AS) can be destroyed by issuing command with following structure:</para>
			<programlisting>m3ua as destroy &lt;as-name&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as-name</term>
					<listitem>
						<para>Simple string name, which identifies AS. Make sure AS is in state INACTIVE and all the ASP's are unassigned before destroying</para>
					</listitem>
				</varlistentry>	
			</variablelist>
			<example>
				<title>Destroy AS</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as destroy AS1
Successfully destroyed AS name=AS1
				</screen>
			</example>
		</section>	
		
		<section
			id="shell_m3ua_as_side_show">
			<title>Show AS</title>
			<para>Application Server configured can viewed by issuing command with following structure:</para>
			<programlisting>m3ua as show </programlisting>
			<example>
				<title>Show AS</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as show
Not supported yet
				</screen>
			</example>
		</section>			
				
		<section
			id="shell_m3ua_asp_side_create">
			<title>Create ASP</title>
			<para>Application Server Process (ASP) can be created by issuing command with following structure:</para>
			<programlisting>m3ua asp create &lt;asp-name&gt; &lt;sctp-association&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>asp-name</term>
					<listitem>
						<para>Name of this ASP. It should be unique</para>
					</listitem>
				</varlistentry>	
				<varlistentry>
					<term>sctp-association</term>
					<listitem>
						<para>name of SCTP Association</para>
					</listitem>
				</varlistentry>								
			</variablelist>
			<example>
				<title>ASP creation</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua asp create ASP1 Assoc1
Successfully created AS name=ASP1
				</screen>
			</example>
		</section>
		<section
			id="shell_m3ua_asp_side_destroy">
			<title>Destroy ASP</title>
			<para>ASP can be destroyed by issuing command with following structure:</para>
			<programlisting>m3ua asp destroy &lt;asp-name&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>asp-name</term>
					<listitem>
						<para>Name of this ASP to be destroyed. Make sure ASP is stopped before destroying</para>
					</listitem>
				</varlistentry>	
			</variablelist>
			<example>
				<title>Destroy ASP</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua asp destroy ASP1
Successfully destroyed ASP name=ASP1
				</screen>
			</example>
		</section>		
		
		<section
			id="shell_m3ua_asp_side_show">
			<title>Show ASP</title>
			<para>ASP configured can be viewed by issuing command with following structure:</para>
			<programlisting>m3ua asp show </programlisting>
			<example>
				<title>Show ASP</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua asp show
Not supported yet
				</screen>
			</example>
		</section>		
		<section
			id="shell_m3ua_as_side_startasp">
			<title>Start ASP</title>
			<para>Application Server Process (ASP) can be started with following structure</para>
			<programlisting>m3ua asp start &lt;asp-name&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>asp name</term>
					<listitem>
						<para>name of ASP created earlier. Make sure ASP you are trying to start is assigned to at least one AS</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Start ASP</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua asp start ASP1
Successfully started ASP name=ASP1
				</screen>
			</example>
		</section>	
		<section
			id="shell_m3ua_as_side_stopasp">
			<title>Stop ASP</title>
			<para>Application Server Process (ASP) can be stopped with following structure</para>
			<programlisting>m3ua asp stop &lt;asp-name&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>asp name</term>
					<listitem>
						<para>name of ASP started earlier.</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<example>
				<title>Stop ASP</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua asp stop ASP1
Successfully stopped ASP name=ASP1
				</screen>
			</example>
		</section>			
		<section
			id="shell_m3ua_as_side_add">
			<title>Add ASP to AS</title>
			<para>Application Server Process (ASP) can be assigned to Application Server (AS) with following structure</para>
			<programlisting>m3ua as add &lt;as-name&gt; &lt;asp-name&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as name</term>
					<listitem>
						<para>
							name of AS created earlier
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>asp name</term>
					<listitem>
						<para>name of ASP created earlier</para>
					</listitem>
				</varlistentry>
			</variablelist>
			<note>
				<title>Note</title>
				<para>
				  Mobicents M3UA supports configuring ASP to process signalling traffic related to more than one Application Server, over a single
   SCTP Association. However you need to make sure that all the AS's that ASP is shared with has Routing Context (unique) configured. 
				</para>
			</note>
			<example>
				<title>Add ASP to AS</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as add AS1 ASP1
Successfully added ASP name=ASP1 to AS name=AS1
				</screen>
			</example>
		</section>
		
		<section
			id="shell_m3ua_as_side_remove">
			<title>Remove ASP from AS</title>
			<para>Application Server Process (ASP) can be unassigned from Application Server (AS) with following structure</para>
			<programlisting>m3ua as remove &lt;as-name&gt; &lt;asp-name&gt; </programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as name</term>
					<listitem>
						<para>
							name of AS 
						</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>asp name</term>
					<listitem>
						<para>name of ASP </para>
					</listitem>
				</varlistentry>
			</variablelist>
		
			<example>
				<title>Remove ASP from AS</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua as remove AS1 ASP1
Successfully removed ASP name=ASP1 from AS name=AS1
				</screen>
			</example>
		</section>		
		
		<section
			id="shell_m3ua_as_side_route_add">
			<title>Add Route</title>
			<para>Configure the destination point code that message will be routed to</para>
			<programlisting>m3ua route add &lt;as-name&gt; &lt;dpc&gt; &lt;opc&gt; &lt;si&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as name</term>
					<listitem>
						<para>name of AS created earlier</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>dpc</term>
					<listitem>
						<para>Destination point code</para>
					</listitem>
				</varlistentry>			
				<varlistentry>
					<term>opc</term>
					<listitem>
						<para>Originating point code</para>
					</listitem>
				</varlistentry>			
				<varlistentry>
					<term>si</term>
					<listitem>
						<para>Service Indicator</para>
					</listitem>
				</varlistentry>							
			</variablelist>
			<example>
				<title>Add Route</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua route add AS1 2 -1 -1
				</screen>
			</example>
		</section>		
		<section
			id="shell_m3ua_as_side_route_remove">
			<title>Remove Route</title>
			<para>Remove the As configured for the destination point code</para>
			<programlisting>m3ua route remove &lt;as-name&gt; &lt;dpc&gt; &lt;opc&gt; &lt;si&gt;</programlisting>
			<para>Where:</para>
			<variablelist>
				<varlistentry>
					<term>as name</term>
					<listitem>
						<para>name of AS assigned to route message for this dpc</para>
					</listitem>
				</varlistentry>
				<varlistentry>
					<term>dpc</term>
					<listitem>
						<para>Destination point code</para>
					</listitem>
				</varlistentry>	
				<varlistentry>
					<term>opc</term>
					<listitem>
						<para>Originating point code</para>
					</listitem>
				</varlistentry>			
				<varlistentry>
					<term>si</term>
					<listitem>
						<para>Service Indicator</para>
					</listitem>
				</varlistentry>						
			</variablelist>
			<example>
				<title>Remove Route</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua route remove AS1 2 -1 -1
				</screen>
			</example>
		</section>		
		<section
			id="shell_m3ua_as_side_route_show">
			<title>Show Route</title>
			<para>Show all the routes configured</para>
			<programlisting>m3ua route show</programlisting>

			<example>
				<title>Show Route</title>
				<screen>
mobicents(127.0.0.1:3435)>m3ua route show
				</screen>
			</example>
		</section>
				
	</section>		
</section>